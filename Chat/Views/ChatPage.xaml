<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:Chat"
    xmlns:localHelpers="clr-namespace:Chat.Helpers"
    xmlns:partials="clr-namespace:Chat.Views.Partials"
    xmlns:controls ="clr-namespace:Chat.Controls"
    x:Class="Chat.Views.ChatPage">
    <ContentPage.Resources>
        <ResourceDictionary>
            <localHelpers:ChatTemplateSelector
                x:Key="MessageTemplateSelector" />
        </ResourceDictionary>
    </ContentPage.Resources>
  
    <Grid
        RowSpacing="0"  
        ColumnSpacing="0">
        <Grid.RowDefinitions>
            <RowDefinition 
                Height="*" />
            <RowDefinition
                Height="auto" />

        </Grid.RowDefinitions>
        <controls:ExtendedListView
            Grid.Row="0"
              ItemTemplate="{StaticResource MessageTemplateSelector}"
            ItemsSource="{Binding Messages}"
            Margin="0"
            ItemTapped="OnListTapped"
            HasUnevenRows="true"
            VerticalOptions="FillAndExpand"
            
            SeparatorColor="Transparent"
            FlowDirection="RightToLeft"
            Rotation="180"
            x:Name="ChatList" 
             ItemAppearingCommand="{Binding MessageAppearingCommand}"
            ItemDisappearingCommand="{Binding MessageDisappearingCommand}"
            >
            
            
            
        </controls:ExtendedListView>

        <Frame HorizontalOptions="EndAndExpand" 
                                 Margin="0,0,2,15"
                                 VerticalOptions="End"
                                 HasShadow="false" 
                                 Grid.Row="0"  
                                 HeightRequest="50" WidthRequest="50"
                                 CornerRadius="25"
                                 Padding="1"
                                 BackgroundColor="LightGreen"   
                                 IsVisible="{Binding ShowScrollTap,Mode=TwoWay}">
            <StackLayout Spacing="3">
                <Label Text="{Binding PendingMessageCount}"
                              HorizontalOptions="CenterAndExpand"
                              IsVisible="{Binding PendingMessageCountVisible}"
                              VerticalTextAlignment="Center"
                              TextColor="{DynamicResource primary}"/>
                <Image Source="ic_scrolldown"
                               WidthRequest="30"
                               HeightRequest="30"
                               VerticalOptions="CenterAndExpand"/>

            </StackLayout>
            <Frame.GestureRecognizers>
                <TapGestureRecognizer Tapped="ScrollTap"/>
            </Frame.GestureRecognizers>
        </Frame>
        
        <partials:ChatInputBarView
            Grid.Row="1"                        
            x:Name="InputBar" />
        
    </Grid>
</ContentPage>